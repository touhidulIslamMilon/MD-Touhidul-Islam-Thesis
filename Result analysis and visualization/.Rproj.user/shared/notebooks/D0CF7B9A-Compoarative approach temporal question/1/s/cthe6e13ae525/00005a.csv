"0",""
"0","# Load required libraries"
"0","library(readxl)"
"0","library(ggplot2)"
"0","library(tidyr)"
"0","library(zoo)  # For rolling averages"
"0","library(dplyr)  # For data manipulation"
"0",""
"0","# Step 1: Load data"
"0","filename <- ""Result/newsimweather_mean.xlsx""  # Update the path if needed"
"0","berd <- read_excel(filename, sheet = ""transpose"")"
"0",""
"0","# Ensure first column is ""day"""
"0","names(berd)[1] <- ""day"""
"0",""
"0","# Convert to long format for ggplot"
"0","berd_long <- pivot_longer(berd, cols = -day, names_to = ""emotion"", values_to = ""score"")"
"0",""
"0","# Convert 'day' to Date format (if not already)"
"0","berd_long$day <- as.Date(berd_long$day)"
"0",""
"0","# Step 2: Apply 7-day rolling average for each emotion"
"0","berd_long <- berd_long %>%"
"0","  group_by(emotion) %>%"
"0","  mutate(rolling_score = rollmean(score, k = 7, align = ""right"", fill = NA)) %>%"
"0","  ungroup()"
"0",""
"0","# Step 3: Remove NA values created by rollmean"
"0","berd_long <- na.omit(berd_long)"
"0",""
"0","# Step 4: Plot with ggplot2"
"0","ggplot(berd_long, aes(x = day, y = rolling_score, color = emotion, group = emotion)) +"
"0","  geom_line(linewidth = 1, linetype = ""solid"") +   # Use solid lines"
"0","  #geom_point(size = 2, alpha = 0.6) +             # Add points for visibility"
"0","  labs(title = ""Emotion Trends (7-day Rolling Avg)"", "
"0","       y = ""Sentiment Score"", "
"0","       x = ""Day"") +"
"0","  theme_minimal() +"
"0","  geom_vline(xintercept = as.Date(""2023-03-16""), color=rgb(0,0,0,0.5))+"
"0","  scale_color_manual(values = rainbow(length(unique(berd_long$emotion)))) +"
"0","    geom_vline(xintercept = as.Date(c(""2019-09-21"", ""2019-12-20"",""2020-03-20"", ""2020-06-20"", ""2020-09-20"", ""2020-12-20"",""2020-03-21"", ""2020-06-21"", ""2020-09-21"", ""2021-12-20"",""2021-03-21"", ""2021-06-21"", ""2021-09-21"", ""2021-12-20"",""2022-03-21"", ""2022-06-21"", ""2022-09-21"", ""2022-12-20"")), "
"0","             color = ""gray"", linetype = ""dashed"", size = 0.5)"
